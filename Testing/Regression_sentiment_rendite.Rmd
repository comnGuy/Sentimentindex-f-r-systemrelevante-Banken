---
title: "Untitled"
output: pdf_document
---

```{r setup}
require(ggplot2)
library(tidyr)
library(tidytext)
library(dplyr)
library(lubridate)
library(reshape2)
library(wordcloud)
#usa pro Monat
daten_usa<-read.csv("C:/Users/Christian/Documents/textmining/R-projekt/BeckerSeminar2/Testing/Daten2012usa.csv")
data_fr_usa<- data.frame(daten_usa, stringsAsFactors=FALSE)
data_fr_usa$Tweets<-as.character(data_fr_usa$Tweets)


#join bing
data_fr_usa$Month2<-NULL
data_fr_usa[data_fr_usa$Month=="Jan","Month2"]<- month(01)
data_fr_usa[data_fr_usa$Month=="Feb","Month2"]<- month(02)
data_fr_usa[data_fr_usa$Month=="Mar","Month2"]<- month(03)
data_fr_usa[data_fr_usa$Month=="Apr","Month2"]<- month(04)
data_fr_usa[data_fr_usa$Month=="May","Month2"]<- month(05)
data_fr_usa[data_fr_usa$Month=="Jun","Month2"]<- month(06)
data_fr_usa[data_fr_usa$Month=="Jul","Month2"]<- month(07)
data_fr_usa[data_fr_usa$Month=="Aug","Month2"]<- month(08)
data_fr_usa[data_fr_usa$Month=="Sep","Month2"]<- month(09)
data_fr_usa[data_fr_usa$Month=="Oct","Month2"]<- month(10)
data_fr_usa[data_fr_usa$Month=="Nov","Month2"]<- month(11)
data_fr_usa[data_fr_usa$Month=="Dec","Month2"]<- month(12)

#doppelt<-distinct(data_fr_usa, id_str)
a<-data_fr_usa %>% inner_join(doppelt)
#sortieren Monate und Tage
sortiernMonth<-data_fr_usa[order(data_fr_usa$Month2, data_fr_usa$DayOfMonth),]
sortab<-sortiernMonth[ sortiernMonth$DayOfMonth>1,]
#variablen definieren für schleife
wochen<-sortab
woche<-0
n<-1
gesamttage<-0
wochen$week<-1
#berechnen der Kalenderwoche
for(n in 1:  length(wochen$DayOfMonth)) {
   if (n==1){
   anzahltag= wochen$DayOfMonth[n]
   print(n)
  }
else if(wochen$DayOfMonth[n] < wochen$DayOfMonth[n-1]) {

if(wochen$Month[n]=="Jan"||wochen$Month[n]=="Mar"||wochen$Month[n]=="Jul"||wochen$Month[n]=="Aug"||wochen$Month[n]=="Oct"|wochen$Month[n]=="Dec"){
  print("gut31")
   endmonth= 31-wochen$DayOfMonth[n-1]
   anfangmonth=wochen$DayOfMonth[n]-0
   anzahltag=endmonth+anfangmonth
  }
  else if (wochen$Month[n]=="Feb"){
    print("Februa")
   endmonth= 29-wochen$DayOfMonth[n-1]
   anfangmonth=wochen$DayOfMonth[n]-0
   anzahltag=endmonth+anfangmonth
  } else{
    print("normal")
  endmonth= 30-wochen$DayOfMonth[n-1]
  anfangmonth=wochen$DayOfMonth[n]-0
  anzahltag=endmonth+anfangmonth}
 
  }else{
    

  anzahltag=wochen$DayOfMonth[n]-wochen$DayOfMonth[n-1]

  }

  gesamttage<- gesamttage+ anzahltag
  mod=gesamttage %% 7
  woche<- gesamttage%/%7
  print(woche)
  print(gesamttage)
   print(mod)
  
  
    print(mod)
    if(mod==0){
      print("H")
    wochen$week[n]<-1
    }
    else{
    wochen$week[n]<-woche
    }
  
 # tidy_2012_ohne_stopwords[n=="Sun",14]
  
}
#plus eins dazu rechnen, da von 0 bis 51 geht
wochen$week<- wochen$week+1
#sentimentanalyse
tidy_daten2012_word <- wochen %>% unnest_tokens(word, Tweets)

a<-tidy_2012_ohne_stopwords %>% select(id_str_tweet)%>% distinct
b<- tidy_2012_ohne_stopwords %>% inner_join(a)#entferne stopwords
tidy_2012_ohne_stopwords <- tidy_daten2012_word %>% anti_join(stop_words)
bing <- get_sentiments("bing")
datplot<-tidy_2012_ohne_stopwords  %>%
  inner_join(bing) %>%
  group_by(week)%>%
  count(sentiment) %>%
spread(sentiment, n)%>%
  mutate(sentiment = positive - negative)
#lese Rendite ein
library(readxl)
Rendite3 <- read_excel("~/textmining/R-projekt/BeckerSeminar2/Testing/Rendite3.xlsx")
View(Rendite3)
#Join rendite mit sentimenanalyse über Kalenderwoche (week)
rendite<-datplot %>% inner_join(Rendite3)
# Multiple Linear Regression Example 
fit <- lm(Rendite ~ sentiment, data=rendite)
summary(fit)

boxplot(rendite$Rendite, main="Rendite", sub=paste("Outlier rows: ", boxplot.stats(rendite$Rendite)$out))  # box plot for 'speed'

plot(rendite$week, rendite$Rendite)
abline(fit, col = "red")


```

## R Markdown

